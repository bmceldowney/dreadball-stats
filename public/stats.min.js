angular.module("services",[]);angular.module("services").service("filterService",function(){var t={};var e="all official season1 season2 season3 house".split(" ");var a=[];t.setFilter=function(t){};t.filterNames=e;return t});angular.module("services").service("dataService",["$http",function(t){var e={};var a="veermyn orxgoblins corporation robot zzor female judwan forgefathers asterians nameless teratons zees".split(" ").sort();var n;var r={lost:[],won:[],draw:[],total:[]};e.getData=function(e){t.get("games").success(function(t){n=t;e()}).error(function(t){})};e.teams=a;e.getMatchData=function(t){var e=[];a.forEach(function(a){var o={};o.team=a;if(a===t){o.data=Object.create(r)}else{o.data=l(t,a,n)}e.push(o)});return e};e.getCoachData=function(){var t=Object.create(null);var e=n.filter(function(t){return t.homecoach||t.viscoach});e.forEach(function(e){var a;if(e.homecoach){n("home",e)}if(e.viscoach){n("vis",e)}function n(n,r){a=e[n+"coach"];if(!t[a]){t[a]={};t[a].matches=[]}t[a].matches.push(r)}});return t};function l(t,e,a){var n=a.filter(function(e){return(e.hometeam===t||e.visitorsteam===t)&&e.valid&&e.rulesversion!=="house"});var r=n.filter(function(a){return a.hometeam===e&&a.visitorsteam===t||a.visitorsteam===e&&a.hometeam===t});return o(t,e,r)}function o(t,e,a){var n=Object.create(r);var l=t+" v. "+e;var o;var i;n.name=l;if(!a)return n;n.total=a;n.won=a.filter(function(e){return e.teamwon===t});n.lost=a.filter(function(e){return e.teamlost===t});n.draw=a.filter(function(t){return t.teamlost==="draw"});n.home=a.filter(function(e){return e.hometeam===t});n.away=a.filter(function(e){return e.visitorsteam===t});n.avgWinScore=0;n.avgLossScore=0;if(n.won.length){o=s(n.won);n.avgWinScore=Math.floor(o/n.won.length*1e3)/1e3}if(n.lost.length){i=s(n.lost);n.avgLossScore=Math.floor(i/n.lost.length*1e3)/1e3}function s(t){return t.map(function(t){return t.finalscore}).reduce(function(t,e){return Number(t)+Number(e)})}return n}return e}]);angular.module("directives",["services"]);angular.module("directives").directive("filterSelector",["filterService",function(t){return{templateUrl:"templates/filterSelector.html",scope:{filters:"=filters",filterChanged:"&filterChanged"},link:function(e,a,n){a.attr("id","filterButtons").css("font-size",".8em");e.$watch("filters",function(e){if(!e)return;e.forEach(function(e){var n=$(document.createElement("input"));n.attr("id",e).attr("type","checkbox").on("click",function(e){t.setFilter(this.id)});var r=$(document.createElement("label"));r.attr("for",e).text(e);a.append(n);a.append(r)});$("#filterButtons").buttonset()})}}}]);angular.module("directives").directive("matchupDetails",function(){return{templateUrl:"templates/matchupDetails.html",scope:{details:"=matchupDetails"},link:function(t,e,a){t.$watch("details",function(e){if(!e)return;t.homeAwayOptions={width:100};t.homeAwayData={name:"match location"};t.homeAwayData.data=[{label:"home",value:e.data.home.length},{label:"away",value:e.data.away.length}];t.winLossOptions={width:100};t.winLossData={name:"win record"};t.winLossData.data=[{label:"wins",value:t.details.data.won.length},{label:"losses",value:t.details.data.lost.length},{label:"draws",value:t.details.data.draw.length}];t.winPercentage=Math.floor(t.details.data.won.length/t.details.data.total.length*1e3)/10+"%";t.losePercentage=Math.ceil(t.details.data.lost.length/t.details.data.total.length*1e3)/10+"%";t.drawPercentage=Math.floor(t.details.data.draw.length/t.details.data.total.length*1e3)/10+"%"})}}});angular.module("directives").directive("teamSelector",function(){return{scope:{teams:"=teamSelector",selectedTeam:"=selectedTeam"},link:function(t,e,a){e.attr("id","radio").css("font-size",".8em");t.$watch("teams",function(a){if(!a)return;a.forEach(function(a){var n=$(document.createElement("input"));n.attr("id",a).attr("type","radio").attr("name","radio").on("click",function(e){t.selectedTeam=this.id;t.$apply()});var r=$(document.createElement("label"));r.attr("for",a).text(a);e.append(n);e.append(r)});$("#radio").buttonset();t.$watch("selectedTeam",function(t){if(!t)return;$("#"+t).attr("checked","checked").button("refresh")})})}}});angular.module("directives").directive("pieChart",function(){return{scope:{data:"=gameData",options:"=options"},link:function(t,e,a){var n=false,r,l,o,i,s,c,d,u,f,h;function m(a){h=t.data&&t.data.name;u=t.options.width||100;f=u/2;r=d3.layout.pie().value(function(t){return t.value}).sort(null);l=d3.svg.arc().outerRadius(f-20);if(h){d3.select(e[0]).append("div").text(h).style("text-align","center").style("margin-bottom","-15px")}c=d3.select(e[0]).append("svg").attr("width",u).attr("height",u).append("g").attr("transform","translate("+u/2+","+u/2+")");d=c.datum(a).selectAll("path").data(r).enter().append("path").attr("d",l).each(function(t){this._current=t});o=$(document.createElement("div"));a.forEach(function(t){$(document.createElement("div")).attr("class","legend-color "+t.label).appendTo(o);$(document.createElement("span")).attr("class","legend-span").text(t.label).appendTo(o)});e.tooltip({items:"svg",content:o[0].outerHTML,track:true});n=true}t.$watch("data",function(t){if(!t)return;data=t.data;if(!n)m(data);r.value(function(t,e){return data[e].value});d=d.data(r);d.attr("class",function(t,e){return data[e].label});d.transition().duration(750).attrTween("d",v)});function p(t){t.apples=+t.apples;t.oranges=+t.oranges;return t}function v(t){var e=d3.interpolate(this._current,t);this._current=e(0);return function(t){return l(e(t))}}}}});angular.module("directives").directive("segmentedBarChart",function(){return{scope:{data:"=segmentedBarChart",selectedMatchup:"=selectedMatchup"},link:function(t,e,a){var n={won:"won".split(""),lost:"lost".split(""),draw:"draw".split(""),total:"total".split("")};var r;var l=[{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n},{team:"nulltown rats",data:n}];var o=d3.select(e[0]).append("div").attr("class","chart");var i=o.selectAll(".chart").data(l).enter().append("div").attr("class","container").on("click",function(a,n){t.selectedMatchup=a;t.$apply();var r=e.children(".chart").children()[n];r&&r.classList.add("selected")});i.append("div").attr("class","label").text(function(t,e,a){return l[a].team});i.append("div").attr("class","wonBar").style("width",u("won")).style("padding",d("won")).text(function(t,e,a){return l[a].data.won.length});i.append("div").attr("class","lostBar").style("width",u("lost")).style("padding",d("lost")).text(function(t,e,a){return l[a].data.lost.length});i.append("div").attr("class","drawBar").style("width",u("draw")).style("padding",d("draw")).text(function(t,e,a){return l[a].data.draw.length});t.$watch("selectedMatchup",s);t.$watch("data",c);function s(t){var a=e.children(".chart").children(".selected");a&&a.removeClass("selected");if(!t)return}function c(e){if(!e)return;t.selectedMatchup=null;l=e;var a=Math.max.apply(Math,l.map(function(t){return t.data.total.length}));r=d3.scale.linear().domain([0,a]).range([5,500]);i=i.data(l);i.style("display",function(t,e,a){var n=l[e].data.total.length?"block":"none";return n});i.selectAll(".label").transition().text(function(t,e,a){return l[a].team});i.selectAll(".wonBar").transition().style("width",u("won")).style("padding",d("won")).text(function(t,e,a){return l[a].data.won.length||""});i.selectAll(".lostBar").transition().style("width",u("lost")).style("padding",d("lost")).text(function(t,e,a){return l[a].data.lost.length||""});i.selectAll(".drawBar").transition().style("width",u("draw")).style("padding",d("draw")).text(function(t,e,a){return l[a].data.draw.length||""})}function d(t){return function(e,a,n){if(!r||!l[n].data[t].length)return 0;return"3px"}}function u(t){return function(e,a,n){if(!r||!l[n].data[t].length)return 0;return r(l[n].data[t].length)+"px"}}}}});angular.module("app",["directives","services"]);angular.module("app").controller("MainCtrl",["$scope","dataService","filterService",function(t,e,a){e.getData(n);function n(){t.teams=e.teams;t.selectedTeam=t.teams[0];t.winLossData=e.getMatchData(t.selectedTeam);t.coachData=e.getCoachData();t.selectedMatchup=null;t.filters=a.filterNames;n();t.filterChanged=function(t){switch(t){case"all":break}};t.$watch("selectedTeam",function(a){if(!a)return;t.winLossData=e.getMatchData(a);n()});function n(){t.winTotal=0;t.lossTotal=0;t.drawTotal=0;t.totalAvgWinScore=0;t.totalAvgLossScore=0;t.winLossData.forEach(function(e){t.winTotal+=e.data.won.length;t.lossTotal+=e.data.lost.length;t.drawTotal+=e.data.draw.length});t.matchTotal=t.winTotal+t.lossTotal+t.drawTotal;var e=t.winLossData.filter(function(t){return t.data.avgWinScore});if(e.length){t.totalAvgWinScore=Math.floor(e.map(function(t){return t.data.avgWinScore}).reduce(function(t,e){return Number(t)+Number(e)})/e.length*1e3)/1e3}var a=t.winLossData.filter(function(t){return t.data.avgLossScore});if(a.length){t.totalAvgLossScore=Math.floor(a.map(function(t){return t.data.avgLossScore}).reduce(function(t,e){return Number(t)+Number(e)})/a.length*1e3)/1e3}t.totalRecordOptions={width:150};t.totalRecordData={name:"win record"};t.totalRecordData.data=[{label:"wins",value:t.winTotal},{label:"losses",value:t.lossTotal},{label:"draws",value:t.drawTotal}]}}}]);